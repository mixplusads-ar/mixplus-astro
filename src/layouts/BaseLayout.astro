---
import "@/styles/globals.css";
const { lang = 'fa', title = 'MixPlus' } = Astro.props;
const isFa = lang === 'fa';
---
<!doctype html>
<html lang={isFa ? 'fa' : 'en'} class="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>

    <!-- پیش‌بارگذاری فونت‌ها (بعداً فایل‌ها را می‌گذاری) -->
    <link rel="preload" href="/fonts/KALAMEHFANUM-REGULAR.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="/fonts/KALAMEH-REGULAR.woff2" as="font" type="font/woff2" crossorigin>
  </head>

  <body class={isFa ? 'rtl font-fa' : 'ltr font-en'}>
    <slot />

    <script>
      // تم از localStorage
      const html = document.documentElement;
      const pref = localStorage.getItem('mix_theme');
      if (pref === 'light') { html.classList.add('light'); html.classList.remove('dark'); }
      else { html.classList.add('dark'); html.classList.remove('light'); }

      // وضعیت اسکرول برای هدر شفاف
      const onScroll = () => { if (window.scrollY > 8) html.classList.add('scrolled'); else html.classList.remove('scrolled'); };
      onScroll(); window.addEventListener('scroll', onScroll, { passive: true });

      // انیمیشن سادهٔ نمایش عناصر .reveal
      const io = new IntersectionObserver((entries) => {
        entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('in'); });
      }, { threshold: .2 });
      document.querySelectorAll('.reveal').forEach(el => io.observe(el));
    </script>
  </body>
</html>
