---
const { lang = 'fa' } = Astro.props;
const isFa = lang === 'fa';
const t = (fa: string, en: string) => (isFa ? fa : en);
---

<div id="searchOverlay" class="fixed inset-0 z-[80] hidden">
  <div class="absolute inset-0 bg-black/50 light:bg-white/60" role="presentation"></div>
  <div class="relative z-[81] mx-auto max-w-[820px] px-6 pt-[15vh]">
    <div class="rounded-2xl border" style="border-color:var(--stroke); background:var(--card);">
      <div class="p-4">
        <input id="searchInput"
          type="search"
          placeholder={t('جستجو...','Search...')}
          class="w-full bg-transparent outline-none text-lg"
          aria-label={t('جستجو','Search')} />
      </div>
      <div class="px-4 pb-4 text-sm text-[var(--fg-muted)]">
        {t('برای خروج Esc را بزنید.','Press Esc to close.')}
      </div>
    </div>
  </div>
</div>

<script>
  (function(){
    const ov = document.getElementById('searchOverlay');
    const input = document.getElementById('searchInput');

    function open() { ov.classList.remove('hidden'); setTimeout(()=>input?.focus(), 0); }
    function close() { ov.classList.add('hidden'); }

    window.addEventListener('mix:openSearch', open);
    window.addEventListener('keydown', (e)=>{ if(e.key==='Escape') close(); });
    ov?.addEventListener('click', (e)=>{ if(e.target === ov) close(); });
  })();
</script>
