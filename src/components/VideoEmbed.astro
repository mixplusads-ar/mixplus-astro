---
/**
 * می‌پذیرد:
 *  1) کد خام HTML (script/iframe)
 *  2) فقط URL
 *
 * مثال مصرف در صفحات: <VideoEmbed src={t.factoryEmbed} />
 */
const { src, title = 'Factory Video', cover = '/media/factory/placeholder.jpg' } = Astro.props;

const raw = (src || '').trim();
const isHtml = raw.startsWith('<');
const isScript = isHtml && /<script[\s>]/i.test(raw);   // اسکریپت آپارات
const isIframe = isHtml && /<iframe[\s>]/i.test(raw);   // iframe یوتیوب/سایر
---
{!isHtml ? (
  /* حالت URL ساده */
  <div class="video-embed">
    <div class="ratio">
      <iframe
        src={raw}
        title={title}
        allow="autoplay; encrypted-media; picture-in-picture"
        allowfullscreen
        loading="lazy"
        referrerpolicy="no-referrer-when-downgrade"
      ></iframe>
    </div>
    <noscript><img src={cover} alt={title} /></noscript>
  </div>
) : isScript ? (
  /* اسکریپت آپارات (خودش ریسپانسیو تولید می‌کند) */
  <div class="video-embed raw-aparat">
    <div class="holder" set:html={raw}></div>
    <noscript><img src={cover} alt={title} /></noscript>
  </div>
) : isIframe ? (
  /* iframe خام (مثلاً YouTube) → می‌بریم داخل ظرف 16:9 و اجبار 100% */
  <div class="video-embed">
    <div class="ratio">
      <div class="raw-iframe" set:html={raw}></div>
    </div>
    <noscript><img src={cover} alt={title} /></noscript>
  </div>
) : (
  /* هر چیز HTML دیگری */
  <div class="video-embed">
    <div class="ratio">
      <div class="raw-iframe" set:html={raw}></div>
    </div>
    <noscript><img src={cover} alt={title} /></noscript>
  </div>
)}

<style>
.video-embed .ratio{
  position:relative; width:100%; aspect-ratio:16/9;
  background:#000; border-radius:16px; overflow:hidden;
  border:1px solid var(--stroke);
}

/* حالت URL و حالت iframe خام: iframe باید کل ظرف را پر کند */
.video-embed iframe{
  position:absolute; inset:0; width:100% !important; height:100% !important; border:0; display:block;
}

/* وقتی iframe خام را با set:html گذاشته‌ایم */
.raw-iframe,
.raw-iframe *{ width:100% !important; height:100% !important; }

/* اسکریپت آپارات: تا لود شدن اسکریپت، فضا نگه داشته شود */
.raw-aparat .holder{
  min-height: 240px;
  border-radius:16px; overflow:hidden; border:1px solid var(--stroke);
  background:#000;
}
</style>
