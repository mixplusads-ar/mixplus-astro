---
/**
 * Props:
 * - lang: 'fa' | 'en'
 * - links?: { youtube?: string; aparat?: string }
 * - title?: string (اختیاری برای a11y)
 * - ratio?: '16/9' | '4/3' | '1/1' (پیش‌فرض 16/9)
 */
const {
  lang = 'fa',
  links = {},
  title = 'MixPlus Video',
  ratio = '16/9',
} = Astro.props as {
  lang?: 'fa' | 'en';
  links?: { youtube?: string; aparat?: string };
  title?: string;
  ratio?: '16/9' | '4/3' | '1/1';
};

const yt = links?.youtube ?? '';
const ap = links?.aparat ?? '';

/* انتخاب منبع بر اساس زبان */
const src = lang === 'fa' ? (ap || yt) : (yt || ap);

/* اگر لینک نداریم، خروجی خالی بده تا بیلد کرش نکند */
if (!src) {
  // می‌تونی بخوای اشاره کوچک نمایشی بگذاریم:
  // <div class="video-empty text-center text-[var(--fg-muted)]">ویدیو در دسترس نیست</div>
}
---

{src && (
  <div class="video-wrap" style={`--ratio:${ratio};`}>
    <iframe
      src={src}
      title={title}
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
      allowfullscreen
      loading="lazy"
      referrerpolicy="no-referrer-when-downgrade"
      class="video-iframe"
    />
  </div>
)}

<style>
  .video-wrap{
    position:relative;
    width:100%;
    aspect-ratio: var(--ratio, 16/9);
    border-radius: 16px;
    overflow: hidden;
    background: #0002;
  }
  .video-iframe{
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    border:0;
    display:block;
  }
</style>
