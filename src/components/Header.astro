---
import { categories } from '@/data/categories';

const { lang = 'fa' } = Astro.props;
const isFa = lang === 'fa';
const t = (fa: string, en: string) => (isFa ? fa : en);
const otherLang = isFa ? 'en' : 'fa';

// 4 آیتم خدمات پس از فروش
const afterSales = [
  { nameFa: 'فرآیند رسیدگی به شکایات', nameEn: 'Complaint Process', slug: 'complaint-process' },
  { nameFa: 'شرایط گارانتی محصولات میکس پلاس و باریستا', nameEn: 'Warranty Terms', slug: 'warranty-terms' },
  { nameFa: 'درخواست نصب محصول', nameEn: 'Installation Request', slug: 'installation-request' },
  { nameFa: 'شکایت', nameEn: 'Complaint', slug: 'complaint' },
];

const catalogHref = isFa ? '/docs/catalog-fa.pdf' : '/docs/catalog-en.pdf';
---

<header class="header fixed top-0 inset-x-0 z-50">
  <div class="relative mx-auto max-w-[1280px] px-4 md:px-6 py-3 flex items-center justify-between">

    <!-- گروه راست (FA) / چپ (EN): محصولات | نمایندگی‌ها | خدمات پس از فروش -->
    <nav class={`nav ${isFa ? 'order-1' : 'order-3'}`} aria-label="primary">
      <!-- محصولات (مگامنو) -->
      <div class="relative group inline-flex items-center">
        <button class="navlink" aria-haspopup="menu">
          {t('محصولات','Products')}
        </button>
        <span class="sep">|</span>
        <div class={`pointer-events-none absolute mt-2 ${isFa ? 'right-0' : 'left-0'}`}>
          <div class="pointer-events-auto opacity-0 translate-y-1 group-hover:opacity-100 group-hover:translate-y-0 dropdown w-[920px] max-w-[90vw]">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
              {categories.map((cat) => (
                <div>
                  <a href={`/${lang}/products/${cat.slug}`} class="font-bold hover:text-brand">{isFa ? cat.nameFa : cat.nameEn}</a>
                  {cat.subs && (
                    <ul class="mt-2 text-sm text-[var(--fg-muted)]">
                      {cat.subs.map((s) => (
                        <li><a class="hover:text-brand" href={`/${lang}/products/${cat.slug}/${s.slug}`}>{isFa ? s.nameFa : s.nameEn}</a></li>
                      ))}
                    </ul>
                  )}
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>

      <a href={`/${lang}/dealers`} class="navlink">{t('نمایندگی‌های مجاز','Authorized Dealers')}</a>
      <span class="sep">|</span>

      <!-- خدمات پس از فروش -->
      <div class="relative group inline-flex items-center">
        <button class="navlink" aria-haspopup="menu">{t('خدمات پس از فروش','After-Sales')}</button>
        <div class={`pointer-events-none absolute mt-2 ${isFa ? 'right-0' : 'left-0'}`}>
          <div class="pointer-events-auto opacity-0 translate-y-1 group-hover:opacity-100 group-hover:translate-y-0 dropdown w-[300px]">
            <ul class="text-sm">
              {afterSales.map((i) => (
                <li><a class="hover:text-brand" href={`/${lang}/after-sales/${i.slug}`}>{isFa ? i.nameFa : i.nameEn}</a></li>
              ))}
            </ul>
          </div>
        </div>
      </div>
    </nav>

    <!-- لوگو وسط -->
    <a href={isFa ? '/fa/' : '/en/'} class="order-2 absolute left-1/2 -translate-x-1/2" aria-label="MixPlus — Home">
      <img src="/img/logo.svg" alt="MixPlus" class="w-16 h-16 block dark:hidden" width="64" height="64" />
      <img src="/img/logo-dark.svg" alt="MixPlus" class="w-16 h-16 hidden dark:block" width="64" height="64" />
    </a>

    <!-- گروه چپ (FA) / راست (EN): سوییچ تم | سرچ | هشتگ | درباره | دانلود کاتالوگ | زبان (نمایش زبان فعلی با رول‌اوت) -->
    <div class={`nav ${isFa ? 'order-3' : 'order-1'}`}>
      <!-- سوییچ تم -->
      <button class="theme-toggle navlink" id="themeToggle" title={t('تغییر تم','Toggle theme')} aria-label="toggle theme">
        <!-- آیکون مینیمال (خورشید/ماه) -->
        <svg id="iconSun" viewBox="0 0 24 24" class="dark:hidden"><path fill="currentColor" d="M12 4a1 1 0 011 1v1a1 1 0 11-2 0V5a1 1 0 011-1zm0 13a5 5 0 100-10 5 5 0 000 10zm7-5a1 1 0 011-1h1a1 1 0 110 2h-1a1 1 0 01-1-1zM4 12a1 1 0 01-1 1H2a1 1 0 110-2h1a1 1 0 011 1zm12.95 6.536a1 1 0 011.414 0l.707.707a1 1 0 11-1.414 1.414l-.707-.707a1 1 0 010-1.414zM4.222 4.222a1 1 0 011.414 0l.707.707A1 1 0 115.929 6.343l-.707-.707a1 1 0 010-1.414zm0 15.556a1 1 0 011.414-0l.707.707a1 1 0 01-1.414 1.414l-.707-.707a1 1 0 010-1.414zM18.364 5.636a1 1 0 011.414-1.414l.707.707A1 1 0 1119.07 6.343l-.707-.707z"/></svg>
        <svg id="iconMoon" viewBox="0 0 24 24" class="hidden dark:block"><path fill="currentColor" d="M21 12.79A9 9 0 1111.21 3a7 7 0 109.79 9.79z"/></svg>
      </button>
      <span class="sep">|</span>

      <!-- سرچ (آیکون) -->
      <button class="navlink" onclick="window.dispatchEvent(new CustomEvent('mix:openSearch'))" title={t('جستجو','Search')} aria-label="search">
        <svg width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M10 2a8 8 0 105.293 14.293l4.707 4.707-1.414 1.414-4.707-4.707A8 8 0 0010 2zm0 2a6 6 0 110 12A6 6 0 0110 4z"/></svg>
      </button>
      <span class="sep">|</span>

      <!-- هشتگ / شبکه‌ها -->
      <div class="relative group inline-flex items-center">
        <button class="navlink" aria-haspopup="menu">#</button>
        <div class={`pointer-events-none absolute mt-2 ${isFa ? 'left-0' : 'right-0'}`}>
          <div class="pointer-events-auto opacity-0 translate-y-1 group-hover:opacity-100 group-hover:translate-y-0 dropdown w-[220px]">
            <ul class="text-sm">
              <li><a class="hover:text-brand" href="https://instagram.com" target="_blank">Instagram</a></li>
              <li><a class="hover:text-brand" href="https://www.aparat.com" target="_blank">Aparat</a></li>
              <li><a class="hover:text-brand" href="https://youtube.com" target="_blank">YouTube</a></li>
              <li><a class="hover:text-brand" href="https://www.linkedin.com" target="_blank">LinkedIn</a></li>
            </ul>
          </div>
        </div>
      </div>
      <span class="sep">|</span>

      <a class="navlink" href={`/${lang}/about`}>{t('درباره ما','About')}</a>
      <span class="sep">|</span>

      <a class="navlink" href={catalogHref} download target="_blank" rel="noreferrer">
        {t('دانلود کاتالوگ','Download Catalog')}
      </a>
      <span class="sep">|</span>

      <!-- زبان: نمایش زبان فعلی + رول‌اوت برای سوییچ -->
      <div class="relative group inline-flex items-center">
        <button class="navlink" aria-haspopup="menu">
          {isFa ? 'فارسی' : 'English'}
          <svg width="10" height="10" viewBox="0 0 24 24" style="margin-inline-start:4px"><path fill="currentColor" d="M7 10l5 5 5-5"/></svg>
        </button>
        <div class={`pointer-events-none absolute mt-2 ${isFa ? 'left-0' : 'right-0'}`}>
          <div class="pointer-events-auto opacity-0 translate-y-1 group-hover:opacity-100 group-hover:translate-y-0 dropdown">
            <ul class="text-sm">
              <li><a class="hover:text-brand" href={`/${otherLang}/`}>{isFa ? 'English' : 'فارسی'}</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // سوییچ تم
    const html = document.documentElement;
    const btn = document.getElementById('themeToggle');
    btn?.addEventListener('click', () => {
      const isLight = html.classList.contains('light');
      if (isLight) { html.classList.remove('light'); html.classList.add('dark'); localStorage.setItem('mix_theme','dark'); }
      else { html.classList.remove('dark'); html.classList.add('light'); localStorage.setItem('mix_theme','light'); }
    });
  </script>
</header>
