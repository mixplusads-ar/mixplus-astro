---
/* ============== Imports & helpers ============== */
import * as Cats from '@/data/categories';
const categories = (Cats as any).categories ?? (Cats as any).default ?? [];

import uxUrl from '@/scripts/ux.ts?url';

const { lang = 'fa' } = Astro.props;
const isFa = lang === 'fa';
const t = (fa: string, en: string) => (isFa ? fa : en);
const htmlLang = isFa ? 'fa' : 'en';
const dir = isFa ? 'rtl' : 'ltr';
const otherLang = isFa ? 'en' : 'fa';

/** Ù…Ù†Ùˆ Ø®Ø¯Ù…Ø§Øª Ù¾Ø³ Ø§Ø² ÙØ±ÙˆØ´ */
const afterSales = [
  { nameFa: 'ÙØ±Ø¢ÛŒÙ†Ø¯ Ø±Ø³ÛŒØ¯Ú¯ÛŒ Ø¨Ù‡ Ø´Ú©Ø§ÛŒØ§Øª',        nameEn: 'Complaint Process',    slug: 'complaint-process' },
  { nameFa: 'Ø´Ø±Ø§ÛŒØ· Ú¯Ø§Ø±Ø§Ù†ØªÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª Ù…ÛŒÚ©Ø³â€ŒÙ¾Ù„Ø§Ø³', nameEn: 'Warranty Terms',       slug: 'warranty-terms' },
  { nameFa: 'Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù†ØµØ¨ Ù…Ø­ØµÙˆÙ„',               nameEn: 'Installation Request', slug: 'installation-request' },
  { nameFa: 'Ø´Ú©Ø§ÛŒØª',                           nameEn: 'Complaint',            slug: 'complaint' },
];

const catalogHref = isFa ? '/docs/catalog-fa.pdf' : '/docs/catalog-en.pdf';
const homeHref = `/${isFa ? 'fa' : 'en'}/`;
---

<!-- HEADER -->
<header class="header fixed top-0 inset-x-0 z-[60] transition-all">
  <div class="relative mx-auto max-w-[1280px] px-4 md:px-6 py-3 flex items-center justify-between">

    <!-- Ø³Ù…Øª Ø±Ø§Ø³Øª ØµÙØ­Ù‡ Ø¯Ø± ÙØ§Ø±Ø³ÛŒ / Ú†Ù¾ Ø¯Ø± Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ: Ù…Ù†ÙˆÙ‡Ø§ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª -->
    <nav class={isFa ? 'order-1' : 'order-3'} aria-label="primary">
      <div class="flex items-center gap-4 md:gap-6">
        <!-- Ù…Ø­ØµÙˆÙ„Ø§Øª (Ù…Ú¯Ø§Ù…Ù†Ùˆ) -->
        <div class="relative group">
          <button class="navlink">
            {t('Ù…Ø­ØµÙˆÙ„Ø§Øª', 'Products')}
          </button>

          <!-- dropdown -->
          <div class="dropdown w-[920px] max-w-[90vw] absolute mt-2 z-[70] hidden group-hover:block"
               style="right:0; left:auto;">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
              {categories?.length > 0 && categories.map((cat) => (
                <div>
                  <a href={`/${lang}/products/${cat.slug}`} class="mb-2 block font-bold hover:text-brand">
                    {isFa ? cat.nameFa : cat.nameEn}
                  </a>
                  {cat.subs?.length > 0 && (
                    <ul class="space-y-1 text-sm text-[var(--fg-muted)]">
                      {cat.subs.map((s) => (
                        <li>
                          <a href={`/${lang}/products/${cat.slug}/${s.slug}`} class="hover:text-brand">
                            {isFa ? s.nameFa : s.nameEn}
                          </a>
                        </li>
                      ))}
                    </ul>
                  )}
                </div>
              ))}
            </div>
          </div>
        </div>

        <!-- Ù†Ù…Ø§ÛŒÙ†Ø¯Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø¬Ø§Ø² -->
        <a class="navlink" href={`/${lang}/dealers`}>{t('Ù†Ù…Ø§ÛŒÙ†Ø¯Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø¬Ø§Ø²', 'Authorized Dealers')}</a>

        <!-- Ø®Ø¯Ù…Ø§Øª Ù¾Ø³ Ø§Ø² ÙØ±ÙˆØ´ (Ù…Ú¯Ø§Ù…Ù†Ùˆ) -->
        <div class="relative group">
          <button class="navlink">{t('Ø®Ø¯Ù…Ø§Øª Ù¾Ø³ Ø§Ø² ÙØ±ÙˆØ´', 'After-Sales')}</button>
          <div class="dropdown w-[520px] max-w-[90vw] absolute mt-2 z-[70] hidden group-hover:block"
               style="right:0; left:auto;">
            <ul class="grid grid-cols-1 gap-2 text-sm">
              {afterSales.map((it) => (
                <li class="flex items-start gap-2">
                  <span class="sep"></span>
                  <a class="hover:text-brand" href={`/${lang}/after-sales/${it.slug}`}>
                    {isFa ? it.nameFa : it.nameEn}
                  </a>
                </li>
              ))}
            </ul>
          </div>
        </div>
      </div>
    </nav>

    <!-- Ù„ÙˆÚ¯Ùˆ ÙˆØ³Ø· -->
    <a href={homeHref} class="flex items-center gap-3 order-2" aria-label="MixPlus">
      <!-- Ù†Ø³Ø®Ù‡ Ø±ÙˆØ´Ù† -->
      <img src="/img/logo.svg" alt="MixPlus" class="h-6 dark:hidden" loading="eager" decoding="async" />
      <!-- Ù†Ø³Ø®Ù‡ ØªÛŒØ±Ù‡ -->
      <img src="/img/logo-dark.svg" alt="MixPlus" class="h-6 hidden dark:block" loading="eager" decoding="async" />
    </a>

    <!-- Ø³Ù…Øª Ú†Ù¾ ØµÙØ­Ù‡ Ø¯Ø± ÙØ§Ø±Ø³ÛŒ / Ø±Ø§Ø³Øª Ø¯Ø± Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ: Ø²Ø¨Ø§Ù†/Ø¯Ø±Ø¨Ø§Ø±Ù‡/Ú©Ø§ØªØ§Ù„ÙˆÚ¯/Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§/Ø³Ø±Ú†/ØªÙ… -->
    <div class={isFa ? 'order-3' : 'order-1'}>
      <div class="flex items-center gap-4 md:gap-6">

        <!-- Ø²Ø¨Ø§Ù† -->
        <div class="relative group">
          <button class="navlink">
            <span class="align-middle">{isFa ? 'ÙØ§Ø±Ø³ÛŒ' : 'English'}</span>
            <span class="ml-1 align-middle">â–¾</span>
          </button>
          <div class="dropdown absolute mt-2 z-[70] hidden group-hover:block"
               style={isFa ? 'right:0; left:auto;' : 'left:0; right:auto;' }>
            <ul class="text-sm">
              <li>
                <a class="hover:text-brand" href={`/${otherLang}/`}>{isFa ? 'English' : 'ÙØ§Ø±Ø³ÛŒ'}</a>
              </li>
            </ul>
          </div>
        </div>

        <span class="vsep" aria-hidden="true">|</span>

        <!-- Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ø§ØªØ§Ù„ÙˆÚ¯ -->
        <a class="navlink" href={catalogHref} download>{t('Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ø§ØªØ§Ù„ÙˆÚ¯', 'Download Catalog')}</a>

        <span class="vsep" aria-hidden="true">|</span>

        <!-- Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§ -->
        <a class="navlink" href={`/${lang}/about`}>{t('Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§', 'About')}</a>

        <span class="vsep" aria-hidden="true">|</span>

        <!-- Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ (#) -->
        <div class="relative group">
          <button class="navlink">#</button>
          <div class="dropdown absolute mt-2 z-[70] hidden group-hover:block"
               style={isFa ? 'right:0; left:auto;' : 'left:0; right:auto;' }>
            <ul class="text-sm space-y-1">
              <li><a class="hover:text-brand" href="https://instagram.com" target="_blank" rel="noopener">Instagram</a></li>
              <li><a class="hover:text-brand" href="https://youtube.com"   target="_blank" rel="noopener">YouTube</a></li>
              <li><a class="hover:text-brand" href="https://aparat.com"    target="_blank" rel="noopener">Aparat</a></li>
              <li><a class="hover:text-brand" href="https://linkedin.com"  target="_blank" rel="noopener">LinkedIn</a></li>
            </ul>
          </div>
        </div>

        <span class="vsep" aria-hidden="true">|</span>

        <!-- Ø¬Ø³ØªØ¬Ùˆ -->
        <button class="navlink" aria-label={t('Ø¬Ø³ØªØ¬Ùˆ', 'Search')} id="openSearch">ğŸ”</button>

        <!-- ØªØºÛŒÛŒØ± ØªÙ… -->
        <button class="navlink" id="themeToggle" aria-label={t('ØªØºÛŒÛŒØ± ØªÙ…', 'Toggle theme')}>ğŸŒ“</button>
      </div>
    </div>
  </div>

  <!-- Ø§ÙˆØ±Ù„ÛŒ Ø³Ø¨Ú© Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ§Ù†Ø§ÛŒÛŒ Ø±ÙˆÛŒ Ù‡ÛŒØ±Ùˆ -->
  <div class="hero-overlay pointer-events-none"></div>
</header>

<!-- Ø§Ø³Ú©Ø±ÛŒÙ¾Øª UX (Ø¨Ù‡ ØµÙˆØ±Øª ÙØ§ÛŒÙ„) -->
<script type="module" src={uxUrl}></script>

<!-- ØªÙ…: Ø®ÙˆØ§Ù†Ø¯Ù†/Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage -->
<script>
  const html = document.documentElement;
  const applyStoredTheme = () => {
    const pref = localStorage.getItem('mix_theme');
    if (pref === 'light' || pref === 'dark') {
      html.classList.remove('light', 'dark');
      html.classList.add(pref);
    } else {
      if (!html.classList.contains('light') && !html.classList.contains('dark')) {
        html.classList.add('light');
      }
    }
  };
  applyStoredTheme();

  document.getElementById('themeToggle')?.addEventListener('click', () => {
    const next = html.classList.contains('light') ? 'dark' : 'light';
    html.classList.remove('light', 'dark');
    html.classList.add(next);
    localStorage.setItem('mix_theme', next);
  });
</script>
